<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SkeletonX React Demo</title>
  <style>
    .skeleton-x-node {
      animation: skeleton-loading 2.4s ease infinite;
    }

    @keyframes skeleton-loading {
      0% {
        background-position: 100% 50%;
      }

      100% {
        background-position: 0 50%;
      }
    }
  </style>
  <script>
    var __skeleton__x__lib = (function (exports) {
      'use strict';

      function _slicedToArray(arr, i) {
        return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();
      }

      function _arrayWithHoles(arr) {
        if (Array.isArray(arr)) return arr;
      }

      function _iterableToArrayLimit(arr, i) {
        if (typeof Symbol === "undefined" || !(Symbol.iterator in Object(arr))) return;
        var _arr = [];
        var _n = true;
        var _d = false;
        var _e = undefined;

        try {
          for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {
            _arr.push(_s.value);

            if (i && _arr.length === i) break;
          }
        } catch (err) {
          _d = true;
          _e = err;
        } finally {
          try {
            if (!_n && _i["return"] != null) _i["return"]();
          } finally {
            if (_d) throw _e;
          }
        }

        return _arr;
      }

      function _unsupportedIterableToArray(o, minLen) {
        if (!o) return;
        if (typeof o === "string") return _arrayLikeToArray(o, minLen);
        var n = Object.prototype.toString.call(o).slice(8, -1);
        if (n === "Object" && o.constructor) n = o.constructor.name;
        if (n === "Map" || n === "Set") return Array.from(o);
        if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);
      }

      function _arrayLikeToArray(arr, len) {
        if (len == null || len > arr.length) len = arr.length;

        for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];

        return arr2;
      }

      function _nonIterableRest() {
        throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
      }

      function parseStringToRenderDesc(str) {
        var values = str.split('|');
        return {
          top: values[0] || undefined,
          left: values[1] || undefined,
          height: values[2] || undefined,
          width: values[3] || undefined,
          borderTopWidth: values[4] || undefined,
          borderRightWidth: values[5] || undefined,
          borderBottomWidth: values[6] || undefined,
          borderLeftWidth: values[7] || undefined,
          borderRadius: values[8] || undefined,
          borderColor: values[9] || undefined,
          backgroundColor: values[10] || undefined
        };
      }

      /**
       * 骨架渲染描述转为骨架节点render props
       */
      function transforRenderDescToRenderProps(desc) {
        var BorderColor = '#8e9097'; // const ColorLevelMap = [
        //   '#D3D4D7',
        //   '#E9EAEB',
        //   '#F4F4F5',
        //   '#FFF'
        // ];

        var props = {
          top: desc.top + 'px',
          left: desc.left + 'px',
          height: desc.height + 'px',
          width: desc.width + 'px'
        };
        if (desc.backgroundColor !== undefined) props.background = 'linear-gradient(90deg,rgb(190 190 190 / 20%) 25%,hsla(0,0%,50.6%,.24) 37%,hsla(0,0%,74.5%,.2) 63%); background-size: 400% 100%;';
        if (desc.borderColor !== undefined) props.borderColor = BorderColor;
        if (desc.borderBottomWidth !== undefined) props.borderBottomWidth = desc.borderBottomWidth + 'px';
        if (desc.borderTopWidth !== undefined) props.borderTopWidth = desc.borderTopWidth + 'px';
        if (desc.borderRightWidth !== undefined) props.borderRightWidth = desc.borderRightWidth + 'px';
        if (desc.borderLeftWidth !== undefined) props.borderLeftWidth = desc.borderLeftWidth + 'px';
        return props;
      }

      /**
       * @param desc 
       * @param moduleRootDesc 如果传递了moduleRootDesc，则骨架基于moduleRootDesc定位
       */

      function descToHtml(desc, moduleRootDesc) {
        desc = JSON.parse(JSON.stringify(desc));

        if (moduleRootDesc) {
          desc.left = desc.left - moduleRootDesc.left;
          desc.top = desc.top - moduleRootDesc.top;
        }

        var renderProps = transforRenderDescToRenderProps(desc);
        var style = 'z-index:9999999;position:absolute;';

        for (var key in renderProps) {
          style += key.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase() + ':' + renderProps[key] + ';';
        }
        return '<div class="skeleton-x-node" style="' + style + '"></div>';
      }

      function renderToHtml(dataString, moduleId) {
        var _dataString;

        dataString = (_dataString = dataString) !== null && _dataString !== void 0 ? _dataString : window.__skeleton__x__lib.getData();
        if (!dataString) return '';

        var _dataString$split = dataString.split('::'),
          _dataString$split2 = _slicedToArray(_dataString$split, 2),
          renderString = _dataString$split2[0],
          moduleString = _dataString$split2[1];

        var renderDescList = renderString.split(',').map(function (str) {
          return parseStringToRenderDesc(str);
        }); // 渲染模块骨架的情况

        var moduleRootDesc;

        if (moduleId !== undefined) {
          var _moduleMap$moduleId, _moduleMap$moduleId2;

          var moduleMap = moduleString ? JSON.parse(moduleString) : undefined;
          var moduleRootIndex = (_moduleMap$moduleId = moduleMap[moduleId]) === null || _moduleMap$moduleId === void 0 ? void 0 : _moduleMap$moduleId[0];
          var moduleLastIndex = (_moduleMap$moduleId2 = moduleMap[moduleId]) === null || _moduleMap$moduleId2 === void 0 ? void 0 : _moduleMap$moduleId2[1];

          if (moduleRootIndex !== undefined) {
            moduleRootDesc = renderDescList[moduleRootIndex];
            renderDescList = renderDescList.slice(moduleRootIndex, moduleLastIndex + 1);
          }
        }

        var html = '';

        for (var i = 0; i < renderDescList.length; i++) {
          html += descToHtml(renderDescList[i], moduleRootDesc);
        }
        return html;
      }
      function getModuleSize(dataString, moduleId) {
        var _dataString2, _moduleMap$moduleId3;

        dataString = (_dataString2 = dataString) !== null && _dataString2 !== void 0 ? _dataString2 : window.__skeleton__x__lib.getData();
        var size = {
          width: '0px',
          height: '0px'
        };
        if (!dataString || !moduleId) return size;

        var _dataString$split3 = dataString.split('::'),
          _dataString$split4 = _slicedToArray(_dataString$split3, 2),
          renderString = _dataString$split4[0],
          moduleString = _dataString$split4[1];

        var renderDescList = renderString.split(',').map(function (str) {
          return parseStringToRenderDesc(str);
        });
        var moduleMap = JSON.parse(moduleString);
        var moduleRootIndex = (_moduleMap$moduleId3 = moduleMap[moduleId]) === null || _moduleMap$moduleId3 === void 0 ? void 0 : _moduleMap$moduleId3[0];
        if (moduleRootIndex === undefined) return size;
        var desc = renderDescList[moduleRootIndex];
        if (!desc) return size;
        var renderProps = transforRenderDescToRenderProps(desc);
        size.width = renderProps.width;
        size.height = renderProps.height;
        return size;
      }

      function getData() {
        return undefined;
      }

      exports.getData = getData;
      exports.getModuleSize = getModuleSize;
      exports.renderToHtml = renderToHtml;

      Object.defineProperty(exports, '__esModule', { value: true });

      return exports;

    }({}));

  </script>
  <script>
    window.__skeleton__x__data_map = {
      '#/': '15|0|22|43.46875|||||||1,15|142.25|22|91.640625|||||||1,15|332.671875|22|42.3125|||||||1,0|0|595|375|||||||,58|16|148|252|||||10||1,90|32|22|70.046875|||||||1,114|32|21|153|2|2|2|2||0|1,151|32|22|32.34375|||||||1,153|64.34375|21|153|2|2|2|2||0|1,222|16|238|343|||||10||1,254|32|22|311|||||||1,292|32|22|311|||||||1,330|32|22|311|||||||1,368|32|22|311|||||||1,406|32|22|311|||||||1,595|0|22|43.90625|||||||1,617|0|22|43.90625|||||||1,639|0|22|43.90625|||||||1,595|331.09375|22|43.90625|||||||1,617|331.09375|22|43.90625|||||||1,639|331.09375|22|43.90625|||||||1::{"1":[4,8],"2":[9,14],"layout-content":[3,14]}',
      '#/users': '15|0|22|43.46875|||||||1,15|142.25|22|91.640625|||||||1,15|332.671875|22|42.3125|||||||1,0|0|595|375|||||||,52|0|60|375|||||||1,90|0|22|375|||||||0,595|0|22|43.90625|||||||0,617|0|22|43.90625|||||||0,639|0|22|43.90625|||||||0,595|331.09375|22|43.90625|||||||0,617|331.09375|22|43.90625|||||||0,639|331.09375|22|43.90625|||||||0::{"layout-content":[3,5]}',
      '#/about': '15|0|22|43.46875|||||||1,15|142.25|22|91.640625|||||||1,15|332.671875|22|42.3125|||||||1,0|0|595|375|||||||,52|0|22|375|||||||0,595|0|22|43.90625|||||||0,617|0|22|43.90625|||||||0,639|0|22|43.90625|||||||0,595|331.09375|22|43.90625|||||||0,617|331.09375|22|43.90625|||||||0,639|331.09375|22|43.90625|||||||0::{"layout-content":[3,4]}'
    }
    __skeleton__x__lib.getData = function () {
      return __skeleton__x__data_map[location.hash]
    }

  </script>
</head>

<body>
  <script>

  </script>
  <div id="root">
    <script>
      document.write(__skeleton__x__lib.renderToHtml())
    </script>
  </div>
  <script src="./index.tsx"></script>
</body>

</html>